<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>타자 연습</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        #text-container {
            white-space: pre-wrap;
            background-color: #9b59b6;
            color: white;
            padding: 20px;
            font-size: 18px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        #input-area {
            width: 100%;
            padding: 10px;
            font-size: 18px;
            border: 2px solid #9b59b6;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        #recent-inputs {
            background-color: #ffffff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        .recent-input-item {
            margin-bottom: 10px;
            font-size: 16px;
        }
        .error {
            color: red;
        }
        .correct {
            color: #05ff05;
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            display: none;
        }
        /* 타자 연습 시작 버튼 스타일 */
        button {
            background-color: #8e44ad;
            color: white;
            font-size: 18px;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #732d91; /* 호버 시 색상 변경 */
        }
        button:focus {
            outline: none;
        }
    </style>
</head>
<body>
    <h1>타자 연습 프로그램</h1>

    <div id="text-container"></div>

    <textarea id="input-area" disabled placeholder="타자를 시작하려면 텍스트를 입력하세요" rows="2" cols="60" oninput="checkInput()"></textarea>

    <div id="recent-inputs">
        <h3>최근 입력한 문장</h3>
        <div id="recent-1" class="recent-input-item"></div>
        <div id="recent-2" class="recent-input-item"></div>
        <div id="recent-3" class="recent-input-item"></div>
    </div>

    <button onclick="startTyping()">타자 연습 시작</button>

    <div id="result">
        <h3>타자 연습 결과</h3>
        <p id="time-taken"></p>
        <p id="saved-result"></p>
    </div>

    <div id="history">
        <h3>타자 연습 기록</h3>
        <ul id="history-list"></ul>
    </div>

    <script>
        const practiceText = `우리가
사람들 앞에서 10분 안에
성경 창세기부터
1234`.split('\n');

        let currentLineIndex = 0;
        let recentInputs = [];
        let finished = false;
        let startTime, endTime;

        // 타자 연습 시작 함수
        function startTyping() {
            currentLineIndex = 0;
            document.getElementById('input-area').value = "";
            document.getElementById('input-area').disabled = false;
            document.getElementById('text-container').textContent = practiceText[currentLineIndex];
            document.getElementById('recent-1').textContent = '';
            document.getElementById('recent-2').textContent = '';
            document.getElementById('recent-3').textContent = '';
            finished = false;
            document.getElementById('input-area').focus();
            document.getElementById('result').style.display = "none";
            startTime = new Date(); // 타자 연습 시작 시간 기록
        }

        // 실시간 입력 체크 및 오타 확인
        function checkInput() {
            const typedText = document.getElementById('input-area').value.trim();
            const currentLine = practiceText[currentLineIndex].trim();
            let resultHTML = "";
            let isCorrect = true;

            // 입력한 문자와 원본 텍스트를 비교하며 실시간으로 결과를 표시
            for (let i = 0; i < currentLine.length; i++) {
                const originalChar = currentLine[i] || '';
                const typedChar = typedText[i] || '';

                if (typedChar === '') {
                    resultHTML += originalChar; // 아직 입력하지 않은 부분은 원본 텍스트 그대로
                } else if (originalChar === typedChar) {
                    resultHTML += `<span class="correct">${originalChar}</span>`; // 맞게 입력된 부분은 초록색
                } else {
                    resultHTML += `<span class="error">${originalChar}</span>`; // 오타가 있는 부분은 빨간색
                    isCorrect = false;
                }
            }

            // 현재 줄을 비교한 결과로 업데이트
            document.getElementById('text-container').innerHTML = resultHTML;

            // 사용자가 모든 문자를 정확히 입력하면 다음 줄로 넘어감
            if (typedText === currentLine && !finished) {
                recentInputs.unshift(typedText); // 최근 입력 문장 리스트에 추가
                updateRecentInputs(); // 최근 입력 문장 업데이트

                document.getElementById('input-area').value = ""; // 입력창 비우기
                currentLineIndex++;

                if (currentLineIndex < practiceText.length) {
                    document.getElementById('text-container').textContent = practiceText[currentLineIndex];
                } else {
                    finished = true;
                    document.getElementById('text-container').textContent = "모든 문장을 완료했습니다!";
                    document.getElementById('input-area').disabled = true;
                    endTime = new Date(); // 타자 연습 끝난 시간 기록
                    
                    showResult(); // 결과 보여주기
                }
            }
        }

        // 최근 입력한 문장 3개를 화면에 표시
        function updateRecentInputs() {
            document.getElementById('recent-1').textContent = recentInputs[0] || '';
            document.getElementById('recent-2').textContent = recentInputs[1] || '';
            document.getElementById('recent-3').textContent = recentInputs[2] || '';
        }

        // 타자 연습 완료 후 결과 보여주기
        function showResult() {
            const timeTaken = (endTime - startTime) / 1000; // 걸린 시간(초 단위)
            document.getElementById('time-taken').textContent = `걸린 시간: ${timeTaken}초`;
            
            // 타자 기록 저장 및 표시
            const savedResult = `입력한 문장들: ${recentInputs.join(' / ')}`;
            //document.getElementById('saved-result').textContent = savedResult;

            document.getElementById('result').style.display = "block";

            // 결과 저장
            saveResult(timeTaken);
        }
		
		// 결과를 localStorage에 저장하는 함수
        function saveResult(timeTaken) {
            const history = JSON.parse(localStorage.getItem('typingHistory')) || [];
            const currentDate = new Date().toLocaleString();
            history.push({ date: currentDate, time: timeTaken });
            localStorage.setItem('typingHistory', JSON.stringify(history));

            // 저장된 기록을 업데이트해서 보여줌
            displayHistory();
        }

        // 저장된 기록을 화면에 표시하는 함수
        function displayHistory() {
            const history = JSON.parse(localStorage.getItem('typingHistory')) || [];
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            history.forEach((entry, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = `${index + 1}. ${entry.date} - ${entry.time}초`;
                historyList.appendChild(listItem);
            });
        }
		
		window.onload = function() {
            displayHistory();
        };
    </script>
</body>
</html>
